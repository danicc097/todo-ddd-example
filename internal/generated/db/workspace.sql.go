// Code generated by sqlc. DO NOT EDIT.
// versions:
//   sqlc v1.30.0
// source: workspace.sql

package db

import (
	"context"
	"time"

	"github.com/danicc097/todo-ddd-example/internal/infrastructure/db/types"
	"github.com/google/uuid"
)

const BulkUpsertWorkspaceMembers = `-- name: BulkUpsertWorkspaceMembers :exec
INSERT INTO workspace_members(workspace_id, user_id, role)
SELECT
  UNNEST($1::uuid[]),
  UNNEST($2::uuid[]),
  UNNEST($3::text[])
ON CONFLICT (workspace_id,
  user_id)
  DO UPDATE SET ROLE = EXCLUDED.role
`

type BulkUpsertWorkspaceMembersParams struct {
	WorkspaceIds []uuid.UUID `db:"workspace_ids" json:"workspace_ids"`
	UserIds      []uuid.UUID `db:"user_ids" json:"user_ids"`
	Roles        []string    `db:"roles" json:"roles"`
}

func (q *Queries) BulkUpsertWorkspaceMembers(ctx context.Context, db DBTX, arg BulkUpsertWorkspaceMembersParams) error {
	_, err := db.Exec(ctx, BulkUpsertWorkspaceMembers, arg.WorkspaceIds, arg.UserIds, arg.Roles)
	return err
}

const CreateWorkspace = `-- name: CreateWorkspace :one
INSERT INTO workspaces(id, name, description, created_at)
  VALUES ($1, $2, $3, $4)
RETURNING
  id, name, description, created_at
`

type CreateWorkspaceParams struct {
	ID          types.WorkspaceID `db:"id" json:"id"`
	Name        string            `db:"name" json:"name"`
	Description string            `db:"description" json:"description"`
	CreatedAt   time.Time         `db:"created_at" json:"created_at"`
}

func (q *Queries) CreateWorkspace(ctx context.Context, db DBTX, arg CreateWorkspaceParams) (Workspaces, error) {
	row := db.QueryRow(ctx, CreateWorkspace,
		arg.ID,
		arg.Name,
		arg.Description,
		arg.CreatedAt,
	)
	var i Workspaces
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.CreatedAt,
	)
	return i, err
}

const DeleteWorkspace = `-- name: DeleteWorkspace :exec
DELETE FROM workspaces
WHERE id = $1
`

func (q *Queries) DeleteWorkspace(ctx context.Context, db DBTX, id types.WorkspaceID) error {
	_, err := db.Exec(ctx, DeleteWorkspace, id)
	return err
}

const GetWorkspaceByID = `-- name: GetWorkspaceByID :one
SELECT
  id, name, description, created_at
FROM
  workspaces
WHERE
  id = $1
`

func (q *Queries) GetWorkspaceByID(ctx context.Context, db DBTX, id types.WorkspaceID) (Workspaces, error) {
	row := db.QueryRow(ctx, GetWorkspaceByID, id)
	var i Workspaces
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.CreatedAt,
	)
	return i, err
}

const GetWorkspaceMembers = `-- name: GetWorkspaceMembers :many
SELECT
  workspace_id, user_id, role
FROM
  workspace_members
WHERE
  workspace_id = $1
`

func (q *Queries) GetWorkspaceMembers(ctx context.Context, db DBTX, workspaceID types.WorkspaceID) ([]WorkspaceMembers, error) {
	rows, err := db.Query(ctx, GetWorkspaceMembers, workspaceID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []WorkspaceMembers{}
	for rows.Next() {
		var i WorkspaceMembers
		if err := rows.Scan(&i.WorkspaceID, &i.UserID, &i.Role); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const ListWorkspaces = `-- name: ListWorkspaces :many
SELECT
  id, name, description, created_at
FROM
  workspaces
ORDER BY
  created_at DESC
LIMIT $1 OFFSET $2
`

type ListWorkspacesParams struct {
	Limit  int32 `db:"limit" json:"limit"`
	Offset int32 `db:"offset" json:"offset"`
}

func (q *Queries) ListWorkspaces(ctx context.Context, db DBTX, arg ListWorkspacesParams) ([]Workspaces, error) {
	rows, err := db.Query(ctx, ListWorkspaces, arg.Limit, arg.Offset)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Workspaces{}
	for rows.Next() {
		var i Workspaces
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Description,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const ListWorkspacesByUserID = `-- name: ListWorkspacesByUserID :many
SELECT
  w.id, w.name, w.description, w.created_at
FROM
  workspaces w
  JOIN workspace_members wm ON w.id = wm.workspace_id
WHERE
  wm.user_id = $1
ORDER BY
  w.created_at DESC
`

func (q *Queries) ListWorkspacesByUserID(ctx context.Context, db DBTX, userID types.UserID) ([]Workspaces, error) {
	rows, err := db.Query(ctx, ListWorkspacesByUserID, userID)
	if err != nil {
		return nil, err
	}
	defer rows.Close()
	items := []Workspaces{}
	for rows.Next() {
		var i Workspaces
		if err := rows.Scan(
			&i.ID,
			&i.Name,
			&i.Description,
			&i.CreatedAt,
		); err != nil {
			return nil, err
		}
		items = append(items, i)
	}
	if err := rows.Err(); err != nil {
		return nil, err
	}
	return items, nil
}

const RemoveWorkspaceMember = `-- name: RemoveWorkspaceMember :exec
DELETE FROM workspace_members
WHERE workspace_id = $1
  AND user_id = $2
`

type RemoveWorkspaceMemberParams struct {
	WorkspaceID types.WorkspaceID `db:"workspace_id" json:"workspace_id"`
	UserID      types.UserID      `db:"user_id" json:"user_id"`
}

func (q *Queries) RemoveWorkspaceMember(ctx context.Context, db DBTX, arg RemoveWorkspaceMemberParams) error {
	_, err := db.Exec(ctx, RemoveWorkspaceMember, arg.WorkspaceID, arg.UserID)
	return err
}

const UpsertWorkspace = `-- name: UpsertWorkspace :one
INSERT INTO workspaces(id, name, description, created_at)
  VALUES ($1, $2, $3, $4)
ON CONFLICT (id)
  DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description
  RETURNING
    id, name, description, created_at
`

type UpsertWorkspaceParams struct {
	ID          types.WorkspaceID `db:"id" json:"id"`
	Name        string            `db:"name" json:"name"`
	Description string            `db:"description" json:"description"`
	CreatedAt   time.Time         `db:"created_at" json:"created_at"`
}

func (q *Queries) UpsertWorkspace(ctx context.Context, db DBTX, arg UpsertWorkspaceParams) (Workspaces, error) {
	row := db.QueryRow(ctx, UpsertWorkspace,
		arg.ID,
		arg.Name,
		arg.Description,
		arg.CreatedAt,
	)
	var i Workspaces
	err := row.Scan(
		&i.ID,
		&i.Name,
		&i.Description,
		&i.CreatedAt,
	)
	return i, err
}
